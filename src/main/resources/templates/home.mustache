<!DOCTYPE HTML>
<html>
<head>
    <title>INHA STUDY</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta property="og:title" content="INHA STUDY">
    <meta property="og:description" content="스터디그룹을 생성하고 그룹원을 모아보세요!">
    <meta property="og:image" content="https://ifh.cc/g/72QCxI.png">


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;500&display=swap" rel="stylesheet">
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>

    <style>
        .createRoomModal_text1 {
            font-size: 30px;
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
            margin-left: auto;
            margin-top: 10px;
        }
        .createRoomModal_text2 {
            font-size: 25px;
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
            margin-bottom: -25px;
        }
        .createRoomModal_text3 {
            font-size: 20px;
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .createRoomModal_text4 {
            width: 26px;
            font-size: 20px;
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .createRoomModal_background {
            background: #7f9dff;
        }
        .check_margin {
            margin-bottom: 15px;
        }
        .modal-content {
            overflow-y: initial !important;
            border: 2px solid white;
            border-radius: 20px;
        }
        .modal-body {
            height: 600px;
            overflow-y: auto;
        }
        .row {
            margin-bottom: 20px;
        }
        .color1 {
            background: brown;
        }
        .studyPlanModal_text1{
            font-size: 30px;
            color: lightslategray;
            font-family: 'Noto Sans KR', sans-serif;
            margin: auto;
        }
        .studyPlanModal_text2{
            font-size: 25px;
            color: lightslategray;
            font-family: 'Noto Sans KR', sans-serif;
            margin-bottom: -25px;
        }
        .studyPlanModal_text3{
            font-size: 25px;
            color: black;
            font-family: 'Noto Sans KR', sans-serif;
            margin-top: 20px;
        }
        .studyPlanModal_text4 {
            width: 26px;
            font-size: 20px;
            color: black;
            font-family: 'Noto Sans KR', sans-serif;
            margin-top: 20px;
        }
        .studyPlanModal_background{
            background: #fff;
        }
    </style>
</head>
<body class="is-preload">
<style>
    .btn-secondary.disabled, .btn-secondary:disabled {
        color: black;
        background-color: white;
        border-color: black;
        font-family: 'Noto Sans KR', sans-serif;
        margin-bottom: 10px;
        padding-bottom: 2px;
        padding-top: 2px;
        padding-right: 8px;
        padding-left: 8px;
    }
    .input-group {
        position: relative;
        display: flex;
        flex-wrap: wrap;
        align-items: stretch;
        width: 100%;
        font-family: 'Noto Sans KR', sans-serif;
    }
    .btn-sm {
        margin-top: 70px;
        width: 76px;
        float: right;
        color: white;
        background-color: #7f9dff;
        border-color: white;
        border-radius: 4px;
        box-shadow: none;
        font-size: 8px;
        font-family: 'Noto Sans KR', sans-serif;
    }
    .btn2-sm {
        border-bottom-width: 0px;
        border-right-width: 0px;
        border-top-width: 0px;
        border-left-width: 0px;
        color: black;
        float: right;
        font-size: 16px;
        font-family: 'Noto Sans KR', sans-serif;
        margin-right: 7px;
    }
    form.formLogin {
        margin: 0;
        padding: 0;
        float: right;
        width: fit-content;
    }
    .btn-outline-secondary {
        color: black;
        border-color: black;
    }
    .btn-outline-primary {
        margin-right: 10px;
        border-bottom-width: 0px;
        border-right-width: 0px;
        border-top-width: 0px;
        border-left-width: 0px;
        color: black;
        float: right;
        font-size: 16px;
        font-family: 'Noto Sans KR', sans-serif;
    }
    .input-group>:not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback) {
        margin-left: 0px;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        color: black;
        text-align: right;
        padding: 10px;
        font-size: 20px;
        font-family: 'Noto Sans KR';
    }
</style>


<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <header id="header">
        <div class="inner" style="padding-right: 5px">

            <!-- Logo -->
            <a href="/" class="logo">
                <span class="title">INHA Study</span>
            </a>
            <span id="switchLogin">
                <form class="formLogin" action="login.html" method="GET"> <button class="btn btn-sm">Login</button> </form>
            </span>
        </div>
    </header>

    <!-- Main -->
    <div id="main" style="margin-top: 70px;">
        <div class="inner">
            <header>
                <h1>스터디 그룹을 찾고<br>
                    그룹원과 함께 목표를 달성하세요
                </h1>
            </header>
            <div class="input-group mb-3">

                <form action="/home/search" method="GET">
                    <input name="roomTitle" type="text" class="form-control" placeholder="스터디 그룹을 검색하세요" aria-label="Text input with dropdown button" style="height: 56px;width: 480px;">
                </form>
            </div>
            <div>
                <a class="btn btn-secondary btn-lg disabled" type="button" >#토익</a>
                <a class="btn btn-secondary btn-lg disabled" type="button" >#알고리즘</a>
                <a class="btn btn-secondary btn-lg disabled" type="button" >#GSAT</a>
                <a class="btn btn-secondary btn-lg disabled" type="button" >#정처기</a>
                <a class="btn btn-secondary btn-lg disabled" type="button" >#면접</a>
            </div>
            <div>
                <br>
                <button class="btn btn2-sm" id="myPage" style="display: none; margin-right: 0px; width:115px; font-size:13.5px;" onclick="moveMyPage()">MY PAGE</button>

                <button type="button" class="btn btn-outline-primary" id="createRoom" data-bs-toggle="modal" data-bs-whatever="@mdo" onclick="checkLoginCreateRoom()" style="margin-right: 10px;width:170px; font-size:13.5px;">Create Room
                </button>
                <br><br>
                <input id="localId" type="text" hidden>
            </div>
            <div class="modal fade" id="makeRoom" tabindex="-1" aria-labelledby="makeRoomLabel" data-bs-backdrop="static" data-bs-keyboard="false" style="display: none;" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content createRoomModal_background">
                        <div class="modal-header" style="width:105%">
                            <h5 class="modal-title createRoomModal_text1" id="makeRoomLabel" style="margin-bottom: 10px">INHA STUDY</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="margin-right:auto"></button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="mb-3">
                                    <label for="room_title" class="col-form-label createRoomModal_text2">방 제목</label>
                                    <input type="text" class="form-control" id="room_title" placeholder="    최대 50자" maxlength="50" required="" style="margin-top: 30px; background-color:white; height: 40px; border-radius: 4px">
                                </div>
                                <div class="mb-3">
                                    <label class="col-form-label createRoomModal_text2">모집 기간</label>
                                    <div class="row" style="margin-top: 30px; width:150%">
                                        <div class="col-auto">
                                            <input type="date" class="form-control" id="re_start_date" style="width: 135px;" placeholder="시작 일자" aria-label="re_start_date" required="">
                                        </div>
                                        <div class="col-auto">
                                            <h1 style="width: 15px; margin: auto; color: #fff"> ~ </h1>
                                        </div>
                                        <div class="col-auto">
                                            <input type="date" class="form-control" id="re_end_date" style="width: 135px;" placeholder="종료 일자" aria-label="re_end_date" required="" style="margin-top: 15px">
                                        </div>
                                    </div>

                                </div>
                                <div class="mb-3">
                                    <label for="category" class="col-form-label createRoomModal_text2">카테고리</label>
                                    <select class="form-select" id="category" aria-label="Default select example" required="" style="margin-top: 30px; height: 38px">
                                        <option selected="">카테고리</option>
                                        <option value="전공">전공 스터디</option>
                                        <option value="취업">취업 스터디</option>
                                        <option value="어학">어학 스터디</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="max_join" class="col-form-label createRoomModal_text2">최대 입장 인원</label>
                                    <input type="number" class="form-control" id="max_join" oninput="maxPeople(this, 100)" placeholder="최대 인원 100명" required="" style="margin-top: 30px;">
                                </div>
                                <div class="mb-3">
                                    <label class="col-form-label createRoomModal_text2">활동 기간</label>
                                    <div class="row" style="margin-top: 30px; width:150%">
                                        <div class="col-auto">
                                            <input type="date" class="form-control" id="ac_start_date" date-placeholder="시작 일자" aria-label="ac_start_date" required="" style="width: 135px;">
                                        </div>
                                        <div class="col-auto">
                                            <h1 style="width: 15px; margin: auto; color: #fff">~</h1>
                                        </div>
                                        <div class="col-auto">
                                            <input type="date" class="form-control" id="ac_end_date" date-placeholder="종료 일자" aria-label="ac_end_date" required="" style="width: 135px;">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="location" class="col-form-label createRoomModal_text2">활동 장소</label>
                                    <input type="text" class="form-control" id="location" placeholder="    최대 50자" maxlength="50" required="" style="margin-top: 30px; background-color:white; height: 40px; border-radius: 4px">
                                </div>
                                <div class="mb-3">
                                    <label class="col-form-label createRoomModal_text2">활동 시간</label>
                                    <div class="row" style="margin-top: 30px; width:150%">
                                        <div class="col-auto">
                                            <select class="form-select" id="study_count" aria-label="Default select example" required="" style="width:135px; height:38px">
                                                <option selected="">스터디 횟수</option>
                                                <option value="주 1회">주 1회</option>
                                                <option value="주 2회">주 2회</option>
                                                <option value="주 3회">주 3회</option>
                                                <option value="주 4회">주 4회</option>
                                                <option value="주 5회">주 5회</option>
                                                <option value="주 6회">주 6회</option>
                                                <option value="주 7회">주 7회</option>
                                            </select>
                                        </div>
                                        <div class="col-auto">
                                            <h1 style="width: 15px; margin: auto; color: #fff">/</h1>
                                        </div>
                                        <div class="col-auto">
                                            <input type="number" class="form-control" id="study_time" placeholder="소요 시간(숫자)" oninput="activityTime(this, 24)" aria-label="time" required="" style="width: 135px;">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="col-form-label createRoomModal_text2">활동 유형</label>
                                    <div class="row check_margin" style="margin-top:30px; width:150%; margin-right:200px">
                                        <div class="form-check form-check-inline col-auto">
                                            <input class="form-check-input" type="radio" name="active_type" id="online" value="온라인" checked="" hidden>
                                            <label class="form-check-label createRoomModal_text3" style="color:#fff; font-weight:bold; width: 130px;" for="online">
                                                온라인
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline  col-auto" style="margin-left:-65px">
                                            <input class="form-check-input" type="radio" name="active_type" id="offline" value="오프라인" hidden>
                                            <label class="form-check-label createRoomModal_text3" style="color:#fff; font-weight:bold; width: 130px;" for="offline">
                                                오프라인
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline  col-auto" style="margin-left:-50px">
                                            <input class="form-check-input" type="radio" name="active_type" id="blended" value="블렌디드" hidden>
                                            <label class="form-check-label createRoomModal_text3" style="color:#fff; font-weight:bold; width: 130px;" for="blended">
                                                블렌디드
                                            </label>
                                        </div>
                                    </div>

                                </div>
                                <div class="mb-3" style="margin-top:-20px">
                                    <label class="col-form-label createRoomModal_text2">활동 소개</label>
                                    <div class="textarea-wrapper" style="margin-top:30px"><textarea rows="1" cols="10" class="form-control" id="info" placeholder="ex) 세부 활동 내용" style="overflow: hidden;resize: none;height: 0px;margin-top: 20px;"></textarea></div>

                                </div>
                                <div class="mb-3" hidden>
                                    <label class="col-form-label createRoomModal_text2">방장 정보</label>
                                    <input type="text" id="hostId"/>
                                </div>
                            </form>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="font-weight:bold; height:50px; box-shadow: inset 0 0 0 2px #fff; padding-right:8px">닫기</button>
                                <button type="button" class="btn btn-primary" onclick="writeRoom()" style="font-weight:bold; height:50px; box-shadow: inset 0 0 0 2px #fff; padding-right:8px">생성</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <section class="tiles" style="margin-top: 0px;">
                {{#roomList}}
                    <article class="style{{category}}">
                                        <span class="image">
                                            <img src="/images/pic05.jpg" alt="" />
                                        </span>
                        <a style="color: #fff">

                            <h2>{{roomTitle}}</h2>
                            <h2 id="roomTitleId{{id}}" style="color: dimgray"></h2>
                            <div class="content">
                                <p>
                                    <br>모집 기간: {{reStartDate}} ~ {{reEndDate}}
                                    <br>활동 장소: {{location}}
                                    <br>( {{curJoin}} / {{maxJoin}} )
                                </p>
                                <button type="button" class="btn btn-primary" style="background-color:transparent; border-color: #fff; box-shadow: inset 0 0 0 2px #fff;" data-bs-toggle="modal" data-bs-target="#studyPlan{{id}}"
                                        data-bs-whatever="@mdo">스터디계획서
                                </button>
                                <button type="button" class="btn btn-primary" id="joinButton{{id}}" style="background-color:transparent; border-color: #fff; box-shadow: inset 0 0 0 2px #fff;" onclick="checkLoginJoin({{id}})">가입신청
                                </button>
                            </div>

                        </a>
                    </article>
                    <input type="text" id="roomId{{id}}" value="{{id}}" hidden/>
                {{/roomList}}
            </section>


            {{#roomList}}
                <div class="modal fade" id="studyPlan{{id}}" tabindex="-1" aria-labelledby="studyPlanLabel" aria-hidden="true"
                     data-bs-backdrop="static" data-bs-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content studyPlanModal_background">
                            <div class="modal-header">
                                <h5 class="modal-title studyPlanModal_text1" id="studyPlanLabel">*스터디 계획서*</h5>
                            </div>
                            <div class="modal-body">

                                <form>
                                    <div class="mb-3">
                                        <label for="room_title" class="col-form-label studyPlanModal_text2">방 제목</label>
                                        <p class="studyPlanModal_text3">{{roomTitle}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="col-form-label studyPlanModal_text2">모집 기간</label>
                                        <p class="studyPlanModal_text3">{{reStartDate}}   ~   {{reEndDate}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label for="category" class="col-form-label studyPlanModal_text2">카테고리</label>
                                        <p class="studyPlanModal_text3">{{category}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label for="max_join" class="col-form-label studyPlanModal_text2">최대 입장 인원</label>
                                        <p class="studyPlanModal_text3">{{maxJoin}}명</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="col-form-label studyPlanModal_text2">활동 기간</label>
                                        <p class="studyPlanModal_text3">{{acStartDate}}   ~   {{acEndDate}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label for="location" class="col-form-label studyPlanModal_text2">활동 장소</label>
                                        <p class="studyPlanModal_text3">{{location}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="col-form-label studyPlanModal_text2">활동 시간</label>
                                        <p class="studyPlanModal_text3">{{studyCount}}   /   {{studyTime}}시간</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="col-form-label studyPlanModal_text2">활동 유형</label>
                                        <p class="studyPlanModal_text3">{{activeType}}</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="col-form-label studyPlanModal_text2">활동 소개</label>
                                        <p class="studyPlanModal_text3">{{info}}</p>
                                    </div>
                                </form>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="font-weight:bold; height:50px; box-shadow: inset 0 0 0 2px #fff; padding-right:8px">닫기</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {{/roomList}}

        </div>
    </div>
</div>

<!-- Scripts -->
<script>
    let checkLogin;
    let checkRoomId;

    function moveMyPage(){
        location.href = "/mypage/" + localStorage.getItem("localId");
    }

    function checkLoginCreateRoom(){
        if(checkLogin==='Y') {
            $(`#makeRoom`).modal('show');
        }else {
            alert("로그인 후 이용해주세요")
            location.href = "/login.html"
        }
    }
    function checkLoginJoin(roomId){
        if (checkLogin === 'Y') {
            $.ajax({
                async:false,
                type: "PUT",
                url: `/api/addCurJoin/${roomId}`,
                success: function (response) {
                    if (response === "approve") {
                        alert("방에 성공적으로 가입 되셨습니다.");
                        $.ajax({
                            async: false,
                            type: "GET",
                            url: `/api/insertRoomId/${roomId}/${localStorage.getItem('localId')}`,
                            success: function (response) {
                            }
                        })
                        window.location.href = "/memo.html?roomId=" + roomId;
                    } else if (response === "reject") {
                        alert("이미 인원이 가득 찬 방입니다.");
                        return false;
                    }
                }
            })
        }else {
            alert("로그인 후 이용해주세요");
            location.href = "/login.html"
        }
    }
    function maxPeople(el, max) {
        if (el.value > max) {
            alert("최대 인원 수는 100명입니다.");
            el.value = " ";
        }
    }
    function activityTime(el, max) {
        if (el.value > max) {
            alert("소요 시간은 최대 24시간까지 가능합니다.");
            el.value = " ";
        }
    }
    function writeRoom() {
        let room_title = $(`#room_title`).val();
        let re_start_date = $(`#re_start_date`).val();
        let re_end_date = $(`#re_end_date`).val();
        let category = $(`#category`).val();
        let max_join = $(`#max_join`).val();
        let ac_start_date = $(`#ac_start_date`).val();
        let ac_end_date = $(`#ac_end_date`).val();
        let location = $(`#location`).val();
        let study_count = $(`#study_count`).val();
        let study_time = $(`#study_time`).val();
        let active_type = $(`input[name=active_type]:checked`).val();
        let info = $(`#info`).val();
        let hostId=$(`#hostId`).val();
        console.log(active_type);
        let data = {
            'roomTitle': room_title,
            'reStartDate': re_start_date,
            'reEndDate': re_end_date,
            'category': category,
            'maxJoin': max_join,
            'acStartDate': ac_start_date,
            'acEndDate': ac_end_date,
            'location': location,
            'studyCount': study_count,
            'studyTime': study_time,
            'activeType': active_type,
            'info': info,
            'hostId':hostId
        };
        $.ajax({
            async:false,
            type: "POST",
            url: "/api",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function (response) {
                alert('방이 성공적으로 생성되었습니다.');
                //window.location.href = "/mypage/" + localStorage.getItem("localId");
                checkRoomId=response['id'];
            }
        })
        $.ajax({
            async:false,
            type:"GET",
            url:`/api/insertHost/${checkRoomId}/${localStorage.getItem('localId')}`,
            success: function (response){
                window.location.href = "/memo.html?user=" + checkRoomId;

            }

        })
    }
    window.onload=function (){
        localId();
        hostId();
        getRoomId();
    }
    function localId(){
        if(localStorage.getItem('localId')){
            document.getElementById("localId").value = localStorage.getItem('localId');
            $.ajax({
                type: 'GET',
                url: `/api/getCheckLogin/${localStorage.getItem('localId')}`,
                contentType: "String",
                success: function (response){
                    if(response === 'Y'){
                        // alert("CheckLogin 정보(Y)를 가져왔습니다.");
                        $(`#myPage`).show();
                        checkLogin=response;
                        document.getElementById("switchLogin").innerHTML =
                                '<button class="btn btn-sm" onclick=switchCheckLogin(localStorage.getItem("localId"))>Logout</button>'
                        return false;
                    }
                    else{
                        $(`#myPage`).hide();
                        // alert("CheckLogin 정보(N)를 가져왔습니다.")
                        checkLogin=response;
                        document.getElementById("switchLogin").innerHTML =
                                '<form class="formLogin" action="login.html" method="GET"> <button class="btn btn-sm">Login</button> </form>'
                        return false;
                    }
                },
                error: function (){
                    $(`#myPage`).hide();
                    // alert("CheckLogin 정보를 가져오지 못했습니다.")
                    checkLogin='N';
                    return false;
                }
            })
        }
    }

    function hostId(){
        document.getElementById("hostId").value=localStorage.getItem("localId");
    }

    function switchCheckLogin(inputId) {
        $.ajax({
            type: 'PUT',
            url: `/api/switchCheckLogin/${inputId}`,
            success: function (response){
            }
        })
        localStorage.setItem("localId",null);
        location.href = "/";
        return false;
    }

    function getRoomId(){
        $.ajax({
            type: "GET",
            url: `/api/checkMemberRoom/${localStorage.getItem('localId')}`,
            success: function (response){
                // alert(response);
                for(let i=0;i<response.length;i++){
                    let a='joinButton'+response[i]
                    document.getElementById(a).innerHTML='들어가기';
                    document.getElementById(a).onclick=function (){
                        location.href='/memo.html?user='+response[i];
                    }
                }
            },
            error: function (){
                alert("오류!");
            }
        })

        $.ajax({
            type:"GET",
            url:`/api/checkJoinEnd`,
            success: function (response){
                // alert(response);
                for(let i=0;i<response.length;i++){
                    let a='roomTitleId'+response[i];
                    document.getElementById(a).innerHTML='<모집마감>'
                }
            }
        })
    }



</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>